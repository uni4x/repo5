{% extends 'notes/base.html' %}

{% block title %}Edit Note{% endblock %}

{% block content %}

<h1>Edit Note</h1>
<a href="{% url 'notes:index' %}">一覧に戻る</a>  
<button type="submit" form="note-form">Save</button> 
<br> <br> 

    <div class="container">
        <div class="input-area">
            <form method="post" id="note-form">
                {% csrf_token %}
                <div>  
                <label for="id_title">Title:</label>
                <input type="text" name="title" id="id_title" value="{{ note.title }}">
                </div>
                <div>
                <label for="id_tags">Tags:</label>
                <input type="text" name="tags" id="id_tags" value="{{ form.initial.tags }}">
                </div>
                <div>
                <label for="id_content">Content:</label>
                <textarea name="content" cols="40" rows="30" id="id_content">{{ note.content }}</textarea>
                </div>
            </form>
        </div>
        <div class="preview-area">
            <div id="preview"></div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const contentTextarea = document.getElementById('id_content');
    const previewDiv = document.getElementById('preview');
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    function updatePreview() {
        const content = contentTextarea.value;
        fetch('{% url 'notes:preview' %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': csrftoken
            },
            body: `content=${encodeURIComponent(content)}`
        })
        .then(response => response.json())
        .then(data => {
            previewDiv.innerHTML = data.html;
        })
        .catch(error => console.error('Error:', error));
    }

    contentTextarea.addEventListener('input', updatePreview);
    updatePreview(); // 初期表示時にもプレビューを更新
});
</script>

{% endblock %}